# WhatsApp service Dockerfile (stub mode, FastAPI webhook)
FROM python:3.12-slim

ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1

WORKDIR /app

# Install build/runtime deps if needed in future
# RUN apt-get update && apt-get install -y --no-install-recommends curl && rm -rf /var/lib/apt/lists/*

# Install Python dependencies
COPY wha_service/requirements.txt ./wha_service/requirements.txt
RUN pip install --no-cache-dir -r wha_service/requirements.txt

# Copy application code and shared logic reused from telegram_service
COPY wha_service/ ./wha_service/
COPY telegram_service/ ./telegram_service/
COPY myimdb_service/ ./myimdb_service/
COPY utils.py ./utils.py
COPY bot_utils.py ./bot_utils.py

EXPOSE 8080

# Optional healthcheck (requires curl if enabled)
# HEALTHCHECK --interval=30s --timeout=10s --start-period=10s --retries=3 \
#   CMD curl -fsS http://localhost:8080/health || exit 1

CMD ["uvicorn", "wha_service.app:app", "--host", "0.0.0.0", "--port", "8080"]